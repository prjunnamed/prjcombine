<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Device geometry - Project Combine</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../custom.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                    </div>

                    <h1 class="menu-title">Project Combine</h1>

                    <div class="right-buttons">

                    </div>
                </div>


                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="device-geometry"><a class="header" href="#device-geometry">Device geometry</a></h1>
<p>The Virtex 2 devices are made of a rectangular grid of interconnect tiles.</p>
<p>Interconnect rows come in three kinds:</p>
<ul>
<li>bottom IOI row (the bottommost row)</li>
<li>top IOI row (the topmost row)</li>
<li>general row (all other rows)</li>
</ul>
<p>Interconnect columns come in four kinds:</p>
<ul>
<li>left IOI column (the leftmost column)
<ul>
<li>contains <code>INT.CNR</code> and the <code>LL</code> (lower left) corner tile in the bottom IOI row</li>
<li>contains <code>INT.CNR</code> and the <code>UL</code> (upper left) corner tile in the top IOI row</li>
<li>contains <code>INT.IOI</code> and an <code>IOI</code> tile in remaining rows</li>
</ul>
</li>
<li>right IOI column (the rightmost column)
<ul>
<li>contains <code>INT.CNR</code> and the <code>LR</code> (lower right) corner tile in the bottom IOI row</li>
<li>contains <code>INT.CNR</code> and the <code>UR</code> (upper right) corner tile in the top IOI row</li>
<li>contains <code>INT.IOI</code> and an <code>IOI</code> tile in remaining rows</li>
</ul>
</li>
<li>CLB columns (most of the inner columns)
<ul>
<li>contains <code>INT.IOI</code> and an <code>IOI</code> IO tile in the bottom and top IOI rows</li>
<li>contains <code>INT.CLB</code> and a <code>CLB</code> tile in the remaining rows (except for PowerPC holes)</li>
</ul>
</li>
<li>BRAM columns (some of the inner columns), which further come in three kinds:
<ul>
<li>plain BRAM column
<ul>
<li>contains <code>INT.DCM.*</code> and a <code>DCM</code> tile in the bottom and top IOI rows</li>
<li>contains <code>INT.BRAM</code> in the remaining rows, and a <code>BRAM</code> tile every 4 rows (except for PowerPC holes)</li>
</ul>
</li>
<li><code>GT</code> column (Virtex 2 Pro)
<ul>
<li>contains <code>INT.GT.CLKPAD</code> in the bottom and top IOI rows</li>
<li>contains <code>INT.PPC</code> in the 4 rows above bottom IOI row and the 4 rows below top IOI row</li>
<li>contains a <code>GIGABIT.B</code> tile in the bottom and a <code>GIGABIT.T</code> tile at the top</li>
<li>contains <code>INT.BRAM</code> in the remaining rows, and a <code>BRAM</code> tile every 4 rows (except for PowerPC holes)</li>
</ul>
</li>
<li><code>GT10</code> column (Virtex 2 Pro X)
<ul>
<li>contains <code>INT.GT.CLKPAD</code> in the bottom and top IOI rows</li>
<li>contains <code>INT.PPC</code> in the 8 rows above bottom IOI row and the 8 rows below top IOI row</li>
<li>contains a <code>GIGABIT10.B</code> tile in the bottom and a <code>GIGABIT10.T</code> tile at the top</li>
<li>contains <code>INT.BRAM</code> in the remaining rows, and a <code>BRAM</code> tile every 4 rows (except for PowerPC holes)</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>The bottom and top of every interconnect column has <code>TERM.S</code> and <code>TERM.N</code> tiles, respectively. Likewise, the left edge and right edge of every interconnect row has <code>TERM.W</code> and <code>TERM.E</code> tiles.</p>
<h2 id="powerpc-holes"><a class="header" href="#powerpc-holes">PowerPC holes</a></h2>
<p>Virtex 2 Pro and Virtex 2 Pro X devices have hard PowerPC cores, which create a hole in the normal pattern.  The hole is 16 rows high and 10 columns across. The 10 columns involved are always the following, in order:</p>
<ul>
<li>CLB column</li>
<li>BRAM column</li>
<li>6 CLB columns</li>
<li>BRAM column</li>
<li>CLB column</li>
</ul>
<p>The leftmost and rightmost column of the hole, as well as topmost and bottommost row of the hole contain <code>INT.PPC</code> interconnect tiles. The middle 8 columns of the hole and middle 14 rows of the hole have no interconnect tiles.</p>
<p>Right above each bottom <code>INT.PPC</code> tile in the 8 middle columns, there is a <code>PPC.N</code> tile, and below each top <code>INT.PPC</code> tile is a <code>PPC.S</code> tile.</p>
<p>Likewise, each of the 14 middle rows has a <code>PPC.E</code> tile to the right of the left <code>INT.PPC</code> tile and a <code>PPC.W</code> tile to the left of the right <code>INT.PPC</code> tile.</p>
<h2 id="clock-rows"><a class="header" href="#clock-rows">Clock rows</a></h2>
<p>The device has some amount of clock rows. They exist in between interconnect rows, and are not counted in the coordinate system. Each clock row provides dedicated clock routing to some range of interconnect rows.</p>
<p>On the intersection of every clock row and interconnect column there is a <code>GCLKH</code> tile, which distributes the clocks vertically to some segment of interconnect tiles.</p>
<p>The horizontal clock lines in the clock row are driven from <code>GCLKC.*</code> tiles at the intersections with the clock spine.</p>
<h2 id="clock-spine"><a class="header" href="#clock-spine">Clock spine</a></h2>
<p>The device also has a special column, called the clock spine. It is located in between two interconnect columns, somewhere in the middle of the device. It is not counted in the coordinate system.</p>
<p>The clock spine has special tiles dealing with clock interconnect:</p>
<ul>
<li>the bottom IOI row has the <code>CLKB.*</code> tile, with 8 <code>BUFGMUX</code> primitives</li>
<li>the top IOI row has the <code>CLKT.*</code> tile, with 8 <code>BUFGMUX</code> primitives</li>
<li>the middle row has the <code>CLKC</code> tile, which buffers the vertical clock lines</li>
<li>each clock row has a <code>GCLKC.*</code> tile, which multiplexes the vertical clock lines onto the horizontal clock lines</li>
</ul>
<h2 id="io-banks-and-io-buffers"><a class="header" href="#io-banks-and-io-buffers">IO banks and IO buffers</a></h2>
<p>The devices have 8 IO banks, numbered 0 through 7 in clockwise fashion:</p>
<ul>
<li>0: top IO row, to the left of clock spine</li>
<li>1: top IO row, to the right of clock spine</li>
<li>2: right IO column, top half</li>
<li>3: right IO column, bottom half</li>
<li>4: bottom IO row, to the right of clock spine</li>
<li>5: bottom IO row, to the left of clock spine</li>
<li>6: left IO column, bottom half</li>
<li>7: left IO column, top half</li>
</ul>
<p>The edges of the device have <code>IOI</code> tiles, each of which contains 4 <code>IOI</code> (IO interface) primitives that implement IO registers. However, not all <code>IOI</code> primitives have an associated IO buffer.</p>
<p>The IO buffers live in special <code>IOBS.*</code> tiles, contained in:</p>
<ul>
<li>top IOB row, above the top IOI row</li>
<li>bottom IOB row, below the bottom IOI row</li>
<li>left IOB column, to the left of the left IOI column</li>
<li>right IOB column, to the right of the right IOI column</li>
</ul>
<p>The <code>IOBS.*</code> tiles come in multiple variants, and can span one or two <code>IOI</code> tiles.</p>
<p>TODO: more details</p>
<h2 id="pci-logic"><a class="header" href="#pci-logic">PCI logic</a></h2>
<p>A Virtex 2 device contains two instances of <code>PCILOGIC</code>. They are located somewhere near the midpoint of each IOI column.</p>
<h2 id="bitstream-geometry"><a class="header" href="#bitstream-geometry">Bitstream geometry</a></h2>
<p>The bitstream is made of frames, which come in three types:</p>
<ul>
<li>0: main area</li>
<li>1: BRAM data area</li>
<li>2: BRAM interconnect area</li>
</ul>
<p>Frames are identified by their type, major and minor numbers. The major number identifies a column (interconnect column, clock spine, or IOB column), and the minor number identifies a frame within a column. The major numbers are counted separately for each type of frame.</p>
<p>The main area contains the following columns, in order (with major numbers assigned sequentially from 0, one for each column):</p>
<ul>
<li>the clock spine (4 frames)</li>
<li>the left IOB column (4 frames)</li>
<li>the left IOI column (22 frames)</li>
<li>the CLB columns, in order (22 frames each)</li>
<li>the right IOI column (22 frames)</li>
<li>the right IOB column (4 frames)</li>
</ul>
<p>The BRAM data area contains 64 frames for each BRAM column, in order from left. The major numbers are assigned sequentially for each BRAM column starting from 0.</p>
<p>The BRAM interconnect area contains 22 frames for each BRAM column, in order from left. The major numbers are assigned sequentially for each BRAM column starting from 0.</p>
<p>For example, <code>xc2v40</code> has the following frames (<code>type.major.minor</code>):</p>
<ul>
<li><code>0.0.0-3</code>: clock spine (between interconnect X 5 and 6)</li>
<li><code>0.1.0-3</code>: left IOB column</li>
<li><code>0.2.0-21</code>: left IOI column (interconnect X == 0)</li>
<li><code>0.3.0-21</code>: CLB column 1 (interconnect X == 1)</li>
<li><code>0.4.0-21</code>: CLB column 2 (interconnect X == 2)</li>
<li><code>0.5.0-21</code>: CLB column 3 (interconnect X == 4)</li>
<li><code>0.6.0-21</code>: CLB column 4 (interconnect X == 5)</li>
<li><code>0.7.0-21</code>: CLB column 5 (interconnect X == 6)</li>
<li><code>0.8.0-21</code>: CLB column 6 (interconnect X == 7)</li>
<li><code>0.9.0-21</code>: CLB column 7 (interconnect X == 9)</li>
<li><code>0.10.0-21</code>: CLB column 8 (interconnect X == 10)</li>
<li><code>0.11.0-21</code>: right IOI column (interconnect X == 11)</li>
<li><code>0.12.0-3</code>: right IOB column</li>
<li><code>1.0.0-63</code>: BRAM column 1 data</li>
<li><code>1.1.0-63</code>: BRAM column 2 data</li>
<li><code>2.0.0-63</code>: BRAM column 1 interconnect (interconnect X == 3)</li>
<li><code>2.1.0-63</code>: BRAM column 2 interconnect (interconnect X == 8)</li>
</ul>
<p>Each bitstream frame within a device has the same size. The size is <code>32 + num_interconnect_rows * 80</code> bits. The bits are, in order:</p>
<ul>
<li>4 bits for clock rows in bottom half of the device</li>
<li>12 bits for bottom IOB row</li>
<li>80 bits for every interconnect row, in order</li>
<li>12 bits for top IOB row</li>
<li>4 bits for clock rows in top half of the device</li>
</ul>
<p>Thus, every interconnect tile corresponds to a bitstream tile of 22×80 bits. Such bitstream tiles are shared between the interconnect tiles and their associated primitives.</p>
<p>The IOB row tiles are 22×12 bits, and are shared between <code>IOBS.*</code> tiles and <code>TERM.[SN]</code> tiles. Likewise, IOB column tiles are 4×80 bits and are shared between <code>IOBS.*</code> and <code>TERM.[EW]</code>.</p>
<p>Blockram data tiles are 64×320 bits (corresponding to 4 interconnect rows). The blockram data frame space corresponding to IOI and IOB rows is unused.</p>
<p>The space in the intersection of IOB columns and IOB or clock rows is unused.</p>
<p>The clock spine is made mostly of 4×80 tiles, most of which go unused. Additionally, there are two 4×12 tiles at the intersection with IOB rows, which are used for clock spine top/bottom configuration.</p>
<p>Every clock row in the bottom half of the device is assigned one bit from the bottom 4-bit area, in order starting from bit 0 at the bottom of the device. Every clock row in the top half of the device is assigned one bit from the top 4-bit area, in order starting from bit 0 at the <em>top</em> of the device. The remaining space, if any, is unused. The <code>GCLKH</code> tiles thus have 22×1 bits.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../virtex2/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../virtex2/interconnect/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../virtex2/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../virtex2/interconnect/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>



        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
