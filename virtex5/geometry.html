<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Device geometry - Project Combine</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../custom.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                    </div>

                    <h1 class="menu-title">Project Combine</h1>

                    <div class="right-buttons">

                    </div>
                </div>


                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="device-geometry"><a class="header" href="#device-geometry">Device geometry</a></h1>
<h2 id="general-structure"><a class="header" href="#general-structure">General structure</a></h2>
<p>Virtex 5 devices follow the same general structure as <a href="../virtex4/geometry.html">Virtex 4 devices</a>, with minor changes.</p>
<p>Virtex 5 devices are divided into "regions". A region is exactly 20 interconnect tiles high. In addition to 20 interconnect rows, each region has a special HCLK row running through the middle (between rows 9 and 10), which is not counted in the row numbering.</p>
<p>The exact sequence of columns varies with the device. The main available column types are:</p>
<ul>
<li>CLBLL column: contains <code>CLBLL</code> tiles, one for every interconnect tile.</li>
<li>CLBLM column: contains <code>CLBLM</code> tiles, one for every interconnect tile.</li>
<li>BRAM column: contains <code>BRAM</code> tiles, one for every 5 interconnect tiles (ie. 4 <code>BRAM</code> tiles per region)</li>
<li>hard logic column: a variant of BRAM column; contains a mixture of:
<ul>
<li><code>BRAM</code> tiles</li>
<li><code>EMAC</code> tiles (10 interconnect tiles high, replaces two <code>BRAM</code> tiles)</li>
<li><code>PCIE</code> tiles (40 interconnect tiles high, replaces 8 <code>BRAM</code> tiles)</li>
</ul>
</li>
<li>DSP column: contains <code>DSP</code> tiles, one for every 5 interconnect tiles (ie. 4 <code>DSP</code> tiles per region)</li>
<li>IO column: contains <code>IO</code> tiles, one for every interconnect tile; also contains special <code>HCLK_IOI</code> tiles in the HCLK rows</li>
<li>the center column: there is exactly one of those per device; it contains a mixture of <code>CFG</code>, <code>IO</code>, <code>CMT</code> tiles</li>
<li>GT column: contains <code>GTP</code> or <code>GTX</code> tiles, one for every region (ie. one for every 20 interconnect tiles)</li>
</ul>
<p>Each of the above types of columns is colocated with a single interconnect column. The interconnect column consists of:</p>
<ul>
<li><code>INT</code> tiles, one per interconnect row (16 per region)</li>
<li><code>INTF</code> or <code>INTF.DELAY</code> tiles, one for every <code>INT</code> tile, except for <code>INT</code> tiles associated with <code>CLB*</code> tiles
<ul>
<li><code>INTF</code> is associated with <code>BRAM</code>, <code>DSP</code>, <code>IO</code>, <code>CMT</code>, and <code>CFG</code> tiles</li>
<li><code>INTF.DELAY</code> is associated with <code>GTP</code>, <code>GTX</code>, <code>PCIE</code>, <code>EMAC</code>, and <code>PPC</code> tiles</li>
</ul>
</li>
<li><code>HCLK</code> tiles, one per region (located in the HCLK row)</li>
</ul>
<p>Additionally, there are two special kinds of columns that are not counted in the normal column numbering, and exist in between interconnect columns:</p>
<ul>
<li>the clock column, which is always immediately to the right of the center column; it contains:
<ul>
<li>the <code>BUFGCTRL</code> global clock buffers (located next to the <code>CFG</code> tile)</li>
<li><code>CLK_IOB_*</code>, <code>CLK_CMT_*</code>, and <code>CLK_MGT_*</code> tiles, which multiplex and feed clock sources into the <code>BUGCTRL</code> primitives</li>
<li><code>CLK_HROW</code> tiles, which buffer the <code>BUFGCTRL</code> outputs onto HCLK rows</li>
</ul>
</li>
<li>the vbrk columns, the significance of which is unknown</li>
</ul>
<p>There can be up to two dedicated IO columns per device, the left and right IO column. The center column counts as the third IO column.  The left IO column is the leftmost column of the device, except for devices that have a left MGT column, where it is a few columns away from the left edge.  The right IO column is present on all devices except <code>xc5vlx20t</code>, and is located a few columns away from the right edge.</p>
<p>There can be up to two MGT columns on the device, depending on the device type:</p>
<ul>
<li>the <code>lxt</code> and <code>sxt</code> devices have exactly one MGT column, which contains <code>GTP</code> tiles and is the rightmost column of the device</li>
<li>the <code>lx</code> devices have no MGT columns; however, they are suspiciously identical to <code>lxt</code> devices with the rightmost two columns cut off</li>
<li>the <code>fxt</code> devices have exactly one MGT column, which contains <code>GTX</code> tiles and is the rightmost column of the device</li>
<li>the <code>txt</code> devices have exactly two MGT columns, which contain <code>GTX</code> tiles and are the leftmost and rightmost columns of the device</li>
</ul>
<p>If the device contains MGT columns, it also has a hard logic column, which is the second rightmost column of the device, right next to the right MGT column. <code>lx</code> devices have no hard logic column.</p>
<p>The other kinds of columns (CLB, BRAM, DSP) come in varying numbers, locations, and proportions, depending on device size and kind.</p>
<h3 id="powerpc-holes"><a class="header" href="#powerpc-holes">PowerPC holes</a></h3>
<p>Some devices have hard PPC cores, which are the only exceptions to the otherwise regular structure, creating a hole in the interconnect grid.  The hole is 2 regions (40 rows) high and 14 columns across. The 14 columns involved are always the following, in order:</p>
<ul>
<li>CLBLM</li>
<li>CLBLL</li>
<li>BRAM</li>
<li>CLBLM</li>
<li>CLBLL</li>
<li>CLBLM</li>
<li>CLBLL</li>
<li>CLBLM</li>
<li>CLBLL</li>
<li>BRAM</li>
<li>CLBLM</li>
<li>CLBLL</li>
<li>CLBLM</li>
<li>CLBLL</li>
</ul>
<p>The hole always starts at row 0 of a region, and ends at row 19 of another region (ie. it takes up 2 whole regions).</p>
<p>The leftmost/rightmost columns of the hole contain interconnect tiles as usual, providing inputs/outputs to the PPC core. However, the inner 12 columns have no interconnect tiles, and some interconnect lines terminate at the boundaries.</p>
<h3 id="center-column"><a class="header" href="#center-column">Center column</a></h3>
<p>The full-featured center column contains the following main tiles, in order:</p>
<ul>
<li>region <code>c - 6</code> through <code>c - 4</code>: 20 IO tiles per region, one per row, belong to banks 10, 8, 6 (in order from the bottom)</li>
<li>region <code>c - 3</code> and bottom half of region <code>c - 2</code>: three <code>CMT</code> tiles, each of them 10 interconnect rows high</li>
<li>top half of region <code>c - 2</code>: 10 IO tiles, belonging to bank 4</li>
<li>bottom half of region <code>c - 1</code>: 10 IO tiles, belonging to bank 2</li>
<li>top half of region <code>c - 1</code> and bottom half of region <code>c</code>: the <code>CFG</code> tile, which is 20 interconnect rows high</li>
<li>top half of region <code>c</code>: 10 IO tiles, belonging to bank 1</li>
<li>bottom half of region <code>c + 1</code>: 10 IO tiles, belonging to bank 3</li>
<li>top half of region <code>c + 1</code> and all of region <code>c + 2</code>: three <code>CMT</code> tiles, each of them 10 interconnect rows high</li>
<li>region <code>c + 3</code> through <code>c + 5</code>: 20 IO tiles per region, belonging to banks 5, 7, 9 (in order from the bottom)</li>
</ul>
<p>In devices that are less than 12 regions high, this full-featured column will be truncated at the top and the bottom — first trimming off banks 9 and 10, then 7 and 8, then 5 and 6, then CMTs, then finally trimming bank 3.  The center column on the smallest device, <code>xc5vlx20t</code>, contains only one CMT at the bottom, the <code>CFG</code> tile, and banks 1, 2, 4.</p>
<p>In addition to the main tiles, the center column also has special tiles in HCLK rows:</p>
<ul>
<li><code>HCLK_IOI_CMT</code> in the HCLK row above lower <code>CMT</code> segments (region <code>c - 2</code>)</li>
<li><code>HCLK_IOI_BOTCEN</code> in the HCLK row right below <code>CFG</code> (region <code>c - 1</code>)</li>
<li><code>HCLK_IOI_TOPCEN</code> in the HCLK row right above <code>CFG</code> (region <code>c</code>)</li>
<li><code>HCLK_CMT_IOI</code> in the HCLK row below upper <code>CMT</code> segments (region <code>c + 1</code>)</li>
<li><code>HCLK_CMT</code> in the HCLK rows between two <code>CMT</code> tiles (regions <code>c - 3</code> and <code>c + 2</code>)</li>
<li><code>HCLK_IOI_CENTER</code> in the remaining HCLK rows</li>
</ul>
<h3 id="spine-column"><a class="header" href="#spine-column">Spine column</a></h3>
<p>The spine column is responsible for global clock routing.  It has no corresponding interconnect column, borrowing interconnect from the center column where necessary.  It has the following tiles:</p>
<ul>
<li>the <code>CFG</code> tile occupies both the center column and the spine column (specifically, the <code>BUFGCTRL</code> buffers and their multiplexers are in the spine column)</li>
<li>at every HCLK row: a <code>CLK_HROW</code> tile</li>
<li>next to bank 4: a <code>CLK_IOB_B</code> tile (10 rows high)</li>
<li>next to bank 2: a <code>CLK_IOB_T</code> tile (10 rows high)</li>
<li>next to every <code>CMT</code> tile: a <code>CLK_CMT_B</code> (below <code>CFG</code>) or <code>CLK_CMT_T</code> (above <code>CFG</code>) tile (10 rows high)</li>
<li>next to banks 5-10: a <code>CLK_MGT_B</code> (below <code>CFG</code>) or <code>CLK_MGT_T</code> (above <code>CFG</code>) tile, one per bank (or per region); the tile is 10 rows high and occupies the top half of the region (below <code>CFG</code>), or the bottom half of the region (above <code>CFG</code>)</li>
</ul>
<h2 id="bitstream-geometry"><a class="header" href="#bitstream-geometry">Bitstream geometry</a></h2>
<p>The bitstream is made of frames, which come in two types:</p>
<ul>
<li>0: main area</li>
<li>1: BRAM data area</li>
</ul>
<p>The bitstream is split by region — each frame covers 20 interconnect rows plus the HCLK row, and the frame size is independent of device size.</p>
<p>Frames are identified by their type, region, major and minor numbers. The major number identifies a column (interconnect column or the clock spine), and the minor number identifies a frame within a column. The major numbers are counted separately for each type of frame.</p>
<p>For bitstream purposes, the regions are counted using the <code>CFG</code> tile as the origin. Top region 0 is considered to be the region that contains the upper half of the <code>CFG</code> tile, top region 1 is the region above that, and so on. Bottom region 0 is considered to be the region that contains the lower half of the <code>CFG</code> tile, bottom region 1 is the region below that, and so on.</p>
<p>The main area contains all interconnect columns and the clock spine, with major numbers assigned sequentially from 0 on the left, one for each column. The clock spine is included right after the center column, with a separate major number. The columns have the following widths:</p>
<ul>
<li>CLBLL and CLBLM columns: 36 frames</li>
<li>BRAM or hard logic column: 30 frames</li>
<li>DSP column: 28 frames</li>
<li>center or IO column: 54 frames</li>
<li>MGT column: 32 frames</li>
<li>spine column: 4 frames</li>
</ul>
<p>The BRAM data area contains 128 frames for each BRAM column, in order from left. The major numbers are assigned sequentially for each BRAM column starting from 0.</p>
<p>Each frame is exactly 1312 bits long and has the following structure:</p>
<ul>
<li>bits 0-639: interconnect rows 0 to 9 of the region, 64 bits per row</li>
<li>bits 640-651: ECC</li>
<li>bits 652-655: HCLK row</li>
<li>bits 656-671: unused</li>
<li>bits 672-1311: interconnect rows 10 to 19 of the region, 64 bits per row</li>
</ul>
<p>Every interconnect tile thus corresponds to a bitstream tile that is 28×64 to 54×64 bits. The actual interconnect tile is 26×64 bits, occupying the first 26 frames of the column. If <code>INTF</code> or <code>INTF.DELAY</code> tile is present in the tile, it occupies frames 26-27.  The remaining frames, as well as unused space in frames 26-27, are used for configuring the associated primitive tile.</p>
<p>The HCLK row has smaller bitstream tiles, 28×4 to 54×4 bits in size.</p>
<p>The spine column also has smaller bitstream tiles, 4×64 in size, as well as the extra-small 4×4 tiles on intersections with HCLK rows.</p>
<p>The BRAM data tiles are 128×320 bits in size (covering the height of 5 interconnect rows). The area at intersection with HCLK rows is unused.</p>
<h3 id="ecc"><a class="header" href="#ecc">ECC</a></h3>
<p>TODO: reverse, document</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../virtex5/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../virtex5/interconnect.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../virtex5/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../virtex5/interconnect.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>



        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
